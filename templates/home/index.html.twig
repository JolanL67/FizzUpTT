{% extends 'base.html.twig' %}

{% block title %}
	{{ parent() }}
	- Vélo d'appartement BODY B8896
{% endblock %}

{% block body %}
	<h1>Vélo d'appartement BODY B8896</h1>

	{% for i in 1..4 %}
    	<a href="{{ asset('assets/image/velo0' ~ i ~ '.png') }}"><img class="bikeImage" src="{{ asset('assets/image/velo0' ~ i ~ '.png') }}" alt="velo-appartement"></a>
	{% endfor %}

	<h2>Note générale des utilisateurs</h2>

	<div>
		{% if reviews is empty %}
		<p>Cet article n'a pas encore reçu de notes</p>
		{% else %}
		{% set sum = 0 %}
		{% for review in reviews %}
			{% set sum = sum + review.rating %}
		{% endfor %}
		{% set average = sum/reviews|length %}
			{% for i in 1..5 %}
				{% set starAverage = (average >= i ? "fa fa-star checked" : "fa fa-star")  %}
				<span class="{{ starAverage }}"></span>
			{% endfor %}
			<p>{{ reviews|length }} avis utilisateur(s) - Note : {{ average|slice(0,4) }}</p>
		{% endif %}
	</div>

	<div class="usersReview">
		<h2>Liste des avis</h2>

		{% if reviews is empty %}
			<p>Il n'y a pas encore d'avis sur ce produit, soyez le premier à laisser un avis !</p>
		{% else %}
			<label for="review-sort">Trier par :</label>
		<select name="review" id="review-sort">
			<option value="">-- Veuillez choisir une option --</option>
			<option value="date">Date - plus récent</option>
			<option value="rating">Note - plus haute au plus bas</option>
		</select>		
		{% endif %}

        <a class ="reviewButton" href="{{ path('review') }}">
			<button type="button" class="btn btn-outline-info">Laissez votre avis sur le produit !</button>
		</a>

		{{ dump(reviews) }}
		{% for review in reviews %}
			<div class="blockReviews">
				{% if review.image is null %}
					<img class="avatars" src="{{ asset('assets/image/avatar.png') }}" alt="user-avatar">
				{% else %}
					<img class="avatars" src="{{ asset('assets/avatar/' ~ review.image) }}" alt="user-avatar">
				{% endif %}
				<p class="username">{{review.username}}</p>

				<p class ="rating">Note :</p>

                <div class="stars">
					{% for i in 1..5 %}
						{% set starClass = (review.rating >= i ? "fa fa-star checked" : "fa fa-star")  %}
                    	<span class="{{ starClass }}"></span>
					{% endfor %}
                </div>

				<p class ="date"><span class="rating">Posté le : </span>
					{{review.createdAt|date('d-m-Y')}}
					à
					{{review.createdAt|date('H:i')}}
                </p>

                <p class="commentary">{{ review.comment|purify }}</p>
			</div>
		{% endfor %}

	</div>
{% endblock %}